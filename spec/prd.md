这份需求文档基于您提供的核心功能进行了结构化梳理，旨在为开发团队、设计团队和产品经理提供清晰的执行标准。

---

# Claude Code 团队效能可视化与虚拟办公室系统需求规格说明书 (PRD)

**版本号**: v1.0

**状态**: 草稿 (Draft)

**日期**: 2026-02-08

---

## 1. 项目背景与目标 (Background & Objectives)

### 1.1 背景

随着团队内部全面采用 **Claude Code** 作为主要的辅助编码工具，管理者需要量化并直观了解团队成员对该工具的使用频率、场景及效能。同时，为了缓解远程或数字化协作的疏离感，团队希望通过一种“游戏化”的方式展示工作状态。

### 1.2 目标

1. **数据透明化**：通过自动化插件采集 Claude Code 的使用数据。
2. **可视化管理**：提供后台面板供管理者查看详细报表。
3. **团队虚拟化**：构建一个类似于 SkyOffice 的 2D 像素风虚拟办公室，通过角色动态实时反映成员的工作状态（闲逛 vs 专注编码）。

---

## 2. 系统架构概览 (System Architecture)

系统分为三个主要模块：

1. **Claude Code 采集插件 (Client Plugin)**：部署在开发者本地，负责钩子拦截与数据上报。
2. **后端服务与管理平台 (Backend & Admin)**：负责数据接收、SSO 认证、用户管理及数据存储。
3. **虚拟办公室前台 (Virtual Office Frontend)**：基于 Web 的像素风可视化面板，实时展示状态。

---

## 3. 功能需求详情 (Functional Requirements)

### 3.1 模块一：Claude Code 数据上报插件

该插件作为 Claude Code 的扩展或 Wrapper 运行在用户本地终端环境。

#### 3.1.1 认证机制 (Authentication)

- **首次使用流程**：

1. 用户在 CLI 执行初始化命令（如 `claude-tracker login`）。
2. CLI 唤起默认浏览器，跳转至后端 SSO 登录页面。
3. 登录成功后，浏览器回调本地 Server，下发 `Access Token`。
4. 插件将 Token 加密存储于本地配置文件中。

- **自动续期**：支持 Token 过期后的自动刷新或提示重新登录。

#### 3.1.2 数据钩子与上报 (Hooks & Reporting)

- **触发机制**：利用 Claude Code 提供的 Hooks 机制（如 `pre-command`, `post-command`, `on-error` 等）。
- **上报内容**：
- **事件类型**：命令执行、代码生成、对话交互、报错。
- **元数据**：时间戳、耗时、Token 消耗量（如可用）、项目路径 Hash（保护隐私，仅区分项目）。

- **上报策略**：实时异步上报，避免阻塞用户正常编码流程。若网络离线，需将数据缓存，待网络恢复后补传。

---

### 3.2 模块二：后端服务与管理面板

#### 3.2.1 用户与权限管理

- **SSO 集成**：支持主流企业级 SSO 登录（如 Google Workspace, GitHub Organization, Microsoft Entra ID）。
- **用户管理**：管理员可查看已注册成员列表，禁用离职员工账号。

#### 3.2.2 数据接收 API

- 提供 RESTful 或 gRPC 接口接收插件上报的数据。
- **鉴权**：验证插件携带的 Token 有效性。

#### 3.2.3 基础数据报表 (Admin Dashboard)

- **个人报表**：展示单人每日/周的 Claude Code 使用频次、活跃时间段分布。
- **团队报表**：展示团队整体活跃度趋势。

---

### 3.3 模块三：虚拟办公室 (Virtual Office)

这是一个基于 Web 的 2D 可视化页面，用于团队公共展示。

#### 3.3.1 场景与地图 (Map & Environment)

- **地图加载**：加载预设的 Tilemap（瓦片地图），包含办公桌、会议室、休息区等图层。
- **座位系统**：地图上的办公桌定义为“交互点”，每个点对应唯一的坐标。

#### 3.3.2 用户形象设置 (Avatar Setup)

- **注册引导**：用户首次进入 Web 端时触发设置流程。
- **座位选择**：用户需在地图上点击选择一个“固定工位”。
- **形象定制**：
- _基础版_：提供一组预设的像素人物素材库供选择。
- _进阶版（AI Feature）_：允许用户上传照片或输入描述，调用 AI 图像生成接口（如 DALL-E 3 / Midjourney API）生成个性化的像素风 Avatar。

#### 3.3.3 角色行为逻辑 (Behavior Logic)

系统需通过 WebSocket 实时推送状态变更，驱动前端动画。

| 状态                | 触发条件                          | 角色行为表现                                                                          |
| ------------------- | --------------------------------- | ------------------------------------------------------------------------------------- |
| **闲逛 (Idle)**     | 用户 **N分钟** 未操作 Claude Code | 角色离开工位，在地图的可行走区域（走廊、休息区）随机漫步。                            |
| **工作中 (Coding)** | 插件上报了新的 Hook 事件          | 角色立即触发寻路算法，从当前位置移动到用户绑定的**固定工位**，并保持“坐下/打字”状态。 |
| **离线 (Offline)**  | 用户退出 Web 端或长时间无心跳     | 角色消失或变为半透明幽灵状态（可选）。                                                |

#### 3.3.4 可视化数据交互

- **点击交互**：在虚拟办公室中点击任意角色的 Avatar。
- **HUD 弹窗**：弹出该用户的今日概览卡片（Today's Coding Stats），包含：
- 今日 Claude Code 交互次数。
- 最近一次活跃时间。
- 本周活跃度热力图。

---

## 4. 非功能性需求 (Non-functional Requirements)

1. **实时性**：从用户在 CLI敲下命令到虚拟办公室角色开始移动，延迟应控制在 **2秒以内**。
2. **隐私保护**：

- **严禁**上报具体的代码内容、Prompt 文本或敏感业务数据。
- 仅上报“动作行为”和“统计数据”。

3. **并发能力**：后端需支持团队规模（预估 20-100 人）的高频并发上报。
4. **侵入性**：CLI 插件必须轻量化，不得影响 Claude Code 的启动速度和执行效率。

---

## 5. UI/UX 示意描述

### 5.1 登录与设置页

> 简洁的卡片式设计。左侧为 Avatar 预览（支持 AI 生成按钮），右侧为工位选择下拉框或微缩地图点选。

### 5.2 虚拟办公室主界面

> 全屏 2D 俯视视角（Top-down）。
>
> - **背景**：温馨的像素风办公室。
> - **动态**：正在使用 Claude Code 的人，其 Avatar 头顶可能有小的“代码气泡”或键盘敲击动画。
> - **闲逛区**：空闲的 Avatar 可能会聚集在咖啡机旁（算法模拟）。

---

## 6. 后续迭代规划 (Roadmap)

- **P1 (MVP)**：完成数据上报、SSO 登录、基础虚拟办公室（闲逛/工作状态切换）。
- **P2**：AI 生成像素头像功能、详细的个人数据分析面板。
- **P3**：虚拟办公室的互动功能（如两个闲逛的角色靠近时触发自动聊天气泡）。
